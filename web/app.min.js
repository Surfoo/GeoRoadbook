!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},a={},o={},n={}.hasOwnProperty,i=/^\.\.?(\/|$)/,r=function(e,t){for(var a,o=[],n=(i.test(t)?e+"/"+t:t).split("/"),r=0,s=n.length;r<s;r++)a=n[r],".."===a?o.pop():"."!==a&&""!==a&&o.push(a);return o.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},l=function(t){return function(a){var o=r(s(t),a);return e.require(o,t)}},d=function(e,t){var o=_&&_.createHot(e),n={id:e,exports:{},hot:o};return a[e]=n,t(n.exports,l(e),n),n.exports},c=function(e){return o[e]?c(o[e]):e},u=function(e,t){return c(r(s(e),t))},p=function(e,o){null==o&&(o="/");var i=c(e);if(n.call(a,i))return a[i].exports;if(n.call(t,i))return d(i,t[i]);throw new Error("Cannot find module '"+e+"' from '"+o+"'")};p.alias=function(e,t){o[t]=e};var f=/\.[^.\/]+$/,b=/\/index(\.[^\/]+)?$/,m=function(e){if(f.test(e)){var t=e.replace(f,"");n.call(o,t)&&o[t].replace(f,"")!==t+"/index"||(o[t]=e)}if(b.test(e)){var a=e.replace(b,"");n.call(o,a)||(o[a]=e)}};p.register=p.define=function(e,o){if(e&&"object"==typeof e)for(var i in e)n.call(e,i)&&p.register(i,e[i]);else t[e]=o,delete a[e],m(e)},p.list=function(){var e=[];for(var a in t)n.call(t,a)&&e.push(a);return e};var _=e._hmr&&new e._hmr(u,p,t,a);p._cache=a,p.hmr=_&&_.wrap,p.brunch=!0,e.require=p}}(),function(){"undefined"==typeof window?this:window;require.register("app.js",function(e,t,a){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e){var a,o,n=new FileReader,i=[{name:e.name,size:e.size}];n.onload=function(e){return window.DOMParser?(a=new DOMParser,o=a.parseFromString(e.target.result,"text/xml")):(o=new ActiveXObject("Microsoft.XMLDOM"),o.async="false",o.loadXML(e.target.result)),o=a.parseFromString(e.target.result,"application/xml"),o&&"gpx"==o.documentElement.tagName?void(t=e.target.result):(t=null,$("#error").html('<p>"'+i[0].name+'" in an invalid file.<p>').show().delay(3e3).fadeOut(),!1)},n.readAsText(e,"UTF-8")}$("#spoilers4gpx").click(function(e){e.preventDefault(),window.open(this.href)});var t=null;$("#btn_geocaching").click(function(){window.location="/login"}),$("#hint").change(function(){$("#hint_options").toggleClass("hidden")}),$("#sort").change(function(){$("#sort_options").toggleClass("hidden")}),$(".option-help").tooltip({placement:"right"}),$('input[type="submit"]').click(function(){if($("#error").html("").addClass("hidden"),!t&&"undefined"===$("#pocket_list").attr("selected","selected").val()||!t&&""===$("#pocket_list").attr("selected","selected").val())return $("#error").html("<p>A GPX file or a Pocket Query is missing.</p>").toggleClass("hidden"),!1;var e=$(this);return e.button("loading"),$.ajax({url:"/upload",type:"POST",data:{gpx:t,locale:$("#locale").attr("selected","selected").val(),toc:!!$('input[name="toc"]:checked').val(),note:!!$('input[name="note"]:checked').val(),short_desc:!!$('input[name="short_desc"]:checked').val(),long_desc:!!$('input[name="long_desc"]:checked').val(),hint:!!$('input[name="hint"]:checked').val(),hint_encrypted:!!parseInt($('input[name="hint_encrypted"]:checked').val()),waypoints:!!$('input[name="waypoints"]:checked').val(),spoilers:!!$('input[name="spoilers"]:checked').val(),logs:!!$('input[name="logs"]:checked').val(),sort_by:$('input[name="sort_by"]:checked').val(),pagebreak:!!$('input[name="pagebreak"]:checked').val(),images:!!$('input[name="images"]:checked').val(),pocket_guid:$("#pocket_list").attr("selected","selected").val()},success:function(t){if(t&&""!==t&&"object"===("undefined"==typeof t?"undefined":o(t)))return t&&!t.success?($("#error").html("<p>"+t.message+"</p>").show(),void e.button("reset")):void $(location).attr("href",t.redirect)},failure:function(){}}),!1}),$('a[data-dismiss="fileupload"]').click(function(){t=null}),null!==document.getElementById("editable")&&$().ready(function(){tinymce.init({selector:"#editable",language:language,plugins:["advlist autolink link image lists charmap hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking","table contextmenu paste textcolor"],content_css:"../design/roadbook.css",menubar:!1,toolbar1:"undo redo | formatselect fontselect fontsizeselect | forecolor backcolor | bold italic underline strikethrough",toolbar2:"alignleft aligncenter alignright alignjustify |Â bullist numlist outdent indent | link image hr table subscript superscript charmap pagebreak | code fullscreen",browser_spellcheck:!0,pagebreak_separator:'<p class="pagebreak"><!-- pagebreak --></p>',width:"210mm",height:"297mm",schema:"html4",apply_source_formatting:!0,setup:function(e){e.on("change",function(){$("#btn_save").removeClass("disabled").prop("disabled",!1)})}})}),$("#btn_delete").button().click(function(){if($(this).hasClass("disabled"))return!1;if(!confirm("Are you sure to delete your roadbook?"))return!1;var e=tinyMCE.get("editable");e.setProgressState(1),$.ajax({url:"/delete",type:"POST",data:{id:roadbook_id},success:function(e){location.href=e},failure:function(){e.setProgressState(0)}})}),$("#ui_export,#ui_export_exp").on("show",function(){return!$("#btn_export_title").hasClass("disabled")&&void $.getJSON("/roadbook/"+roadbook_id+".json",function(e){$.each(e,function(e,t){$("#"+e).is("input[type=checkbox]")?($("#"+e).attr("value",t),t&&($("#"+e).prop("checked",!0),$("#"+e.substr(0,6)+"_text").prop("disabled",!0))):$("#"+e).is("select")?($("#"+e).val(t),$("#"+e+" option[value="+t+"]").attr("selected","selected")):$("#"+e).is("input")&&$("#"+e).attr("value",t)})})}),$("#btn_save").click(function(){return!$(this).hasClass("disabled")&&void a()}),$("#apply").click(function(){n(!1)}),$("#export").click(function(){a(),$("#ui_export").modal("hide"),n(!0)}),$("#apply_exp").click(function(){i(!1)}),$("#export_exp").click(function(){a(),$("#ui_export_exp").modal("hide"),i(!0)}),$("#header_pagination").click(function(){$("#header_text").prop("disabled",!$("#header_text").prop("disabled"))}),$("#footer_pagination").click(function(){$("#footer_text").prop("disabled",!$("#footer_text").prop("disabled"))});var a=function(){var e=tinyMCE.get("editable");e.setProgressState(1),$.ajax({url:"/save",type:"POST",datatype:"json",data:{id:roadbook_id,content:e.getContent()},beforeSend:function(){$("#btn_save").button("loading")},success:function(t){t&&t.success&&($("#btn_save").attr("title",t.last_modification),e.startContent=e.getContent(),e.isNotDirty=!0)},complete:function(){$("#btn_save").addClass("disabled").prop("disabled",!0).data("loading-text","Save").button("loading")},failure:function(){}}),e.setProgressState(0)},n=function(e){var t=tinyMCE.get("editable");t.setProgressState(1),e=+e,$("#btn_save").addClass("disabled"),$("#btn_export_title").addClass("disabled"),$("#btn_export").addClass("disabled"),$("#btn_download_title").addClass("disabled"),$("#btn_download").addClass("disabled"),$("#btn_delete").addClass("disabled"),$.ajax({url:"/export",type:"POST",data:{real_export:e,id:roadbook_id,"page-size":document.forms[0].page_size.value,orientation:document.forms[0].orientation.value,"margin-left":document.forms[0].margin_left.value,"margin-right":document.forms[0].margin_right.value,"margin-top":document.forms[0].margin_top.value,"margin-bottom":document.forms[0].margin_bottom.value,"header-align":document.forms[0].header_align.value,"header-text":document.forms[0].header_text.value,"header-pagination":!!$('input[name="header_pagination"]:checked').val(),"footer-align":document.forms[0].footer_align.value,"footer-text":document.forms[0].footer_text.value,"footer-pagination":!!$('input[name="footer_pagination"]:checked').val()},success:function(a){if(t.setProgressState(0),$("#btn_save").removeClass("disabled"),$("#btn_export_title").removeClass("disabled"),$("#btn_export").removeClass("disabled"),$("#btn_download_title").removeClass("disabled"),$("#btn_download").removeClass("disabled"),$("#btn_delete").removeClass("disabled"),e)return a&&""!==a?"object"!==("undefined"==typeof a?"undefined":o(a))?void alert("Conversion failed :-(\nMessage:\n"+a):void(a&&a.success?(t.setProgressState(0),$("#dl_pdf").show(),$("#download_link").html(a.link+" ("+a.size+"Mb)"),$("#ui_exported").modal("show")):alert("Conversion failed :-(\nMessage:\n"+a.error)):void alert("Conversion failed :-(")},failure:function(){t.setProgressState(0),$("#btn_save").removeClass("disabled"),$("#btn_export_title").removeClass("disabled"),$("#btn_export").removeClass("disabled"),$("#btn_download_title").removeClass("disabled"),$("#btn_download").removeClass("disabled"),$("#btn_delete").removeClass("disabled"),e&&alert("Error in exportation.")}})},i=function(e){var t=tinyMCE.get("editable");t.setProgressState(1),e=+e,$("#btn_save").addClass("disabled"),$("#btn_export_title").addClass("disabled"),$("#btn_export").addClass("disabled"),$("#btn_download_title").addClass("disabled"),$("#btn_download").addClass("disabled"),$("#btn_delete").addClass("disabled"),$.ajax({url:"/export",type:"POST",data:{real_export:e,id:roadbook_id,experimental:!0,"page-size":document.forms[1].page_size.value,orientation:document.forms[1].orientation.value,"margin-left":document.forms[1].margin_left.value,"margin-right":document.forms[1].margin_right.value,"margin-top":document.forms[1].margin_top.value,"margin-bottom":document.forms[1].margin_bottom.value},success:function(a){if(t.setProgressState(0),$("#btn_save").removeClass("disabled"),$("#btn_export_title").removeClass("disabled"),$("#btn_export").removeClass("disabled"),$("#btn_download_title").removeClass("disabled"),$("#btn_download").removeClass("disabled"),$("#btn_delete").removeClass("disabled"),e)return a&&""!==a?"object"!==("undefined"==typeof a?"undefined":o(a))?void alert("Conversion failed :-(\nMessage:\n"+a):void(a&&a.success?(t.setProgressState(0),$("#dl_pdf").show(),$("#download_link").html(a.link+" ("+a.size+"Mb)"),$("#ui_exported").modal("show")):alert("Conversion failed :-(\nMessage:\n"+a.error)):void alert("Conversion failed :-(")},failure:function(){t.setProgressState(0),$("#btn_save").removeClass("disabled"),$("#btn_export_title").removeClass("disabled"),$("#btn_export").removeClass("disabled"),$("#btn_download_title").removeClass("disabled"),$("#btn_download").removeClass("disabled"),$("#btn_delete").removeClass("disabled"),e&&alert("Error in exportation.")}})};"function"==typeof $("#gpx").fileinput&&$("#gpx").fileinput({browseLabel:"GPX file",showPreview:!0,showUpload:!1,maxFileCount:1,autoReplace:!0,maxFileSize:8192,allowedFileExtensions:["gpx"]}).on("change",function(t){var a=t.target.files||t.dataTransfer.files;return"undefined"!=typeof a[0]&&void e(a[0])})}()}),require.register("___globals___",function(e,t,a){})}(),require("___globals___");