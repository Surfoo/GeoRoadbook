{"version":3,"sources":["app/app.js","node_modules/auto-reload-brunch/vendor/auto-reload.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxVA;AAAA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"web/app.min.js","sourcesContent":["'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n/* jshint esversion: 6 */\n/* global $:true */\n\n(function () {\n    'use strict';\n\n    $('#spoilers4gpx').click(function (event) {\n        event.preventDefault();\n        window.open(this.href);\n    });\n\n    var content_gpx = null;\n\n    $('#btn_geocaching').click(function () {\n        window.location = '/login';\n    });\n\n    $('#hint').change(function () {\n        $('#hint_options').toggleClass('hidden');\n    });\n\n    $('#sort').change(function () {\n        $('#sort_options').toggleClass('hidden');\n    });\n\n    $('.option-help').tooltip({\n        placement: 'right'\n    });\n\n    // output file information\n    function ParseFile(file) {\n        var reader = new FileReader(),\n            parser,\n            doc,\n            fileinfo = [{\n            'name': file.name,\n            'size': file.size\n        }];\n\n        reader.onload = function (e) {\n            if (window.DOMParser) {\n                parser = new DOMParser();\n                doc = parser.parseFromString(e.target.result, 'text/xml');\n            } else {\n                doc = new ActiveXObject('Microsoft.XMLDOM');\n                doc.async = 'false';\n                doc.loadXML(e.target.result);\n            }\n\n            doc = parser.parseFromString(e.target.result, 'application/xml');\n            if (!doc || doc.documentElement.tagName != 'gpx') {\n                content_gpx = null;\n                $('#error').html('<p>\"' + fileinfo[0].name + '\" in an invalid file.<p>').show().delay(3000).fadeOut();\n                return false;\n            }\n            content_gpx = e.target.result;\n        },\n        /*jshint -W030 */\n        reader.readAsText(file, 'UTF-8');\n    }\n\n    $('input[type=\"submit\"]').click(function () {\n        $('#error').html('').addClass('hidden');\n\n        if (!content_gpx || $('#pocket_list').attr('selected', 'selected').val() === '') {\n            $('#error').html('<p>A GPX file or a Pocket Query is missing.</p>').toggleClass('hidden');\n            return false;\n        }\n\n        var btn = $(this);\n        btn.button('loading');\n\n        $.ajax({\n            url: \"/upload\",\n            type: \"POST\",\n            data: {\n                gpx: content_gpx,\n                locale: $('#locale').attr('selected', 'selected').val(),\n                toc: !!$('input[name=\"toc\"]:checked').val(),\n                note: !!$('input[name=\"note\"]:checked').val(),\n                short_desc: !!$('input[name=\"short_desc\"]:checked').val(),\n                long_desc: !!$('input[name=\"long_desc\"]:checked').val(),\n                hint: !!$('input[name=\"hint\"]:checked').val(),\n                hint_encrypted: !!parseInt($('input[name=\"hint_encrypted\"]:checked').val()),\n                waypoints: !!$('input[name=\"waypoints\"]:checked').val(),\n                spoilers: !!$('input[name=\"spoilers\"]:checked').val(),\n                logs: !!$('input[name=\"logs\"]:checked').val(),\n                sort_by: $('input[name=\"sort_by\"]:checked').val(),\n                pagebreak: !!$('input[name=\"pagebreak\"]:checked').val(),\n                images: !!$('input[name=\"images\"]:checked').val(),\n                pocket_guid: $('#pocket_list').attr('selected', 'selected').val()\n            },\n            success: function success(data) {\n                if (!data || data === \"\" || (typeof data === 'undefined' ? 'undefined' : _typeof(data)) !== 'object') {\n                    return;\n                }\n                if (data && !data.success) {\n                    $('#error').html('<p>' + data.message + '</p>').show();\n                    btn.button('reset');\n                    return;\n                }\n                $(location).attr('href', data.redirect);\n            },\n            failure: function failure() {}\n        });\n        return false;\n    });\n\n    $('a[data-dismiss=\"fileupload\"]').click(function () {\n        content_gpx = null;\n    });\n\n    /**** Roadbook *****/\n    if (document.getElementById('editable') !== null) {\n        $().ready(function () {\n            // Config TinyMCE 4\n            tinymce.init({\n                selector: \"#editable\",\n                language: language,\n                plugins: [\"advlist autolink link image lists charmap hr anchor pagebreak\", \"searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking\", \"table contextmenu paste textcolor\"],\n                content_css: \"../design/roadbook.css\",\n                menubar: false,\n                toolbar1: \"undo redo | formatselect fontselect fontsizeselect | forecolor backcolor | bold italic underline strikethrough\",\n                toolbar2: \"alignleft aligncenter alignright alignjustify |Â bullist numlist outdent indent | link image hr table subscript superscript charmap pagebreak | code fullscreen\",\n                browser_spellcheck: true,\n                pagebreak_separator: \"<p class=\\\"pagebreak\\\"><!-- pagebreak --></p>\",\n                width: \"210mm\",\n                height: \"297mm\",\n                schema: \"html4\",\n                apply_source_formatting: true,\n                setup: function setup(editor) {\n                    editor.on('change', function () {\n                        $('#btn_save').removeClass('disabled').prop('disabled', false);\n                    });\n                }\n            });\n        });\n    }\n\n    $(\"#btn_delete\").button().click(function () {\n        if ($(this).hasClass('disabled')) {\n            return false;\n        }\n        if (!confirm('Are you sure to delete your roadbook?')) {\n            return false;\n        }\n        var ed = tinyMCE.get('editable');\n        ed.setProgressState(1);\n\n        $.ajax({\n            url: \"/delete\",\n            type: \"POST\",\n            data: {\n                id: roadbook_id\n            },\n            success: function success(url) {\n                location.href = url;\n            },\n            failure: function failure() {\n                ed.setProgressState(0);\n            }\n        });\n    });\n\n    $('#ui_export').on('show', function () {\n        if ($('#btn_export').hasClass('disabled')) {\n            return false;\n        }\n        $.getJSON('/roadbook/' + roadbook_id + '.json', function (data) {\n            $.each(data, function (key, val) {\n                //checkbox\n                if ($('#' + key).is('input[type=checkbox]')) {\n                    $('#' + key).attr(\"value\", val);\n                    if (val) {\n                        $('#' + key).prop('checked', true);\n                        $(\"#\" + key.substr(0, 6) + \"_text\").prop('disabled', true);\n                    }\n                } else if ($('#' + key).is('select')) {\n                    $('#' + key).val(val);\n                    $('#' + key + ' option[value=' + val + ']').attr('selected', 'selected');\n                } else if ($('#' + key).is('input')) {\n                    $('#' + key).attr(\"value\", val);\n                }\n            });\n        });\n    });\n\n    $(\"#btn_save\").click(function () {\n        if ($(this).hasClass('disabled')) {\n            return false;\n        }\n        saveHtml();\n    });\n\n    $(\"#apply\").click(function () {\n        _ajax(false);\n    });\n\n    $(\"#export\").click(function () {\n        saveHtml();\n        $('#ui_export').modal('hide');\n        _ajax(true);\n    });\n\n    $(\"#header_pagination\").click(function () {\n        $(\"#header_text\").prop('disabled', !$(\"#header_text\").prop(\"disabled\"));\n    });\n\n    $(\"#footer_pagination\").click(function () {\n        $(\"#footer_text\").prop('disabled', !$(\"#footer_text\").prop(\"disabled\"));\n    });\n\n    var saveHtml = function saveHtml() {\n        var ed = tinyMCE.get('editable');\n        ed.setProgressState(1);\n        $.ajax({\n            url: \"/save\",\n            type: \"POST\",\n            datatype: 'json',\n            data: {\n                id: roadbook_id,\n                content: ed.getContent()\n            },\n            beforeSend: function beforeSend() {\n                $('#btn_save').button('loading');\n            },\n            success: function success(data) {\n                if (data && data.success) {\n                    $('#btn_save').attr('title', data.last_modification);\n                    ed.startContent = ed.getContent();\n                    ed.isNotDirty = true;\n                }\n            },\n            complete: function complete() {\n                $('#btn_save').addClass('disabled').prop('disabled', true).data('loading-text', 'Save').button('loading');\n            },\n            failure: function failure() {}\n        });\n        ed.setProgressState(0);\n    };\n\n    var _ajax = function _ajax(real_export) {\n        var ed = tinyMCE.get('editable');\n        ed.setProgressState(1);\n        real_export = +real_export;\n\n        $('#btn_save').addClass('disabled');\n        $('#btn_export').addClass('disabled');\n        $('#btn_download_title').addClass('disabled');\n        $('#btn_download').addClass('disabled');\n        $('#btn_delete').addClass('disabled');\n\n        $.ajax({\n            url: \"/export\",\n            type: \"POST\",\n            data: {\n                real_export: real_export,\n                id: roadbook_id,\n                'page-size': document.forms[0].page_size.value,\n                'orientation': document.forms[0].orientation.value,\n                'margin-left': document.forms[0].margin_left.value,\n                'margin-right': document.forms[0].margin_right.value,\n                'margin-top': document.forms[0].margin_top.value,\n                'margin-bottom': document.forms[0].margin_bottom.value,\n                'header-align': document.forms[0].header_align.value,\n                'header-text': document.forms[0].header_text.value,\n                'header-pagination': !!$('input[name=\"header_pagination\"]:checked').val(),\n                'footer-align': document.forms[0].footer_align.value,\n                'footer-text': document.forms[0].footer_text.value,\n                'footer-pagination': !!$('input[name=\"footer_pagination\"]:checked').val()\n            },\n\n            success: function success(data) {\n                ed.setProgressState(0);\n\n                $('#btn_save').removeClass('disabled');\n                $('#btn_export').removeClass('disabled');\n                $('#btn_download_title').removeClass('disabled');\n                $('#btn_download').removeClass('disabled');\n                $('#btn_delete').removeClass('disabled');\n\n                if (!real_export) {\n                    return;\n                }\n\n                if (!data || data === \"\") {\n                    alert('Conversion failed :-(');\n                    return;\n                }\n                if ((typeof data === 'undefined' ? 'undefined' : _typeof(data)) !== 'object') {\n                    alert('Conversion failed :-(\\nMessage:\\n' + data);\n                    return;\n                }\n\n                if (data && data.success) {\n                    ed.setProgressState(0);\n                    $('#dl_pdf').show();\n                    $('#download_link').html(data.link + ' (' + data.size + 'Mb)');\n                    $('#ui_exported').modal('show');\n                } else {\n                    alert('Conversion failed :-(\\nMessage:\\n' + data.error);\n                }\n            },\n            failure: function failure() {\n                ed.setProgressState(0);\n\n                $('#btn_save').removeClass('disabled');\n                $('#btn_export').removeClass('disabled');\n                $('#btn_download_title').removeClass('disabled');\n                $('#btn_download').removeClass('disabled');\n                $('#btn_delete').removeClass('disabled');\n\n                if (!real_export) {\n                    return;\n                }\n                alert('Error in exportation.');\n            }\n        });\n    };\n\n    // init\n    if (typeof $(\"#gpx\").fileinput === 'function') {\n        $(\"#gpx\").fileinput({\n            'browseLabel': 'GPX file',\n            'showPreview': true,\n            'showUpload': false,\n            'maxFileCount': 1,\n            'autoReplace': true,\n            'maxFileSize': 8192,\n            'allowedFileExtensions': ['gpx']\n        }).on('change', function (e) {\n            // fetch FileList object\n            var files = e.target.files || e.dataTransfer.files;\n            if (typeof files[0] === 'undefined') {\n                return false;\n            }\n            ParseFile(files[0]);\n        });\n    }\n})();\n","'use strict';\n\n/* jshint ignore:start */\n(function () {\n  var WebSocket = window.WebSocket || window.MozWebSocket;\n  var br = window.brunch = window.brunch || {};\n  var ar = br['auto-reload'] = br['auto-reload'] || {};\n  if (!WebSocket || ar.disabled) return;\n  if (window._ar) return;\n  window._ar = true;\n\n  var cacheBuster = function cacheBuster(url) {\n    var date = Math.round(Date.now() / 1000).toString();\n    url = url.replace(/(\\&|\\\\?)cacheBuster=\\d*/, '');\n    return url + (url.indexOf('?') >= 0 ? '&' : '?') + 'cacheBuster=' + date;\n  };\n\n  var browser = navigator.userAgent.toLowerCase();\n  var forceRepaint = ar.forceRepaint || browser.indexOf('chrome') > -1;\n\n  var reloaders = {\n    page: function page() {\n      window.location.reload(true);\n    },\n\n    stylesheet: function stylesheet() {\n      [].slice.call(document.querySelectorAll('link[rel=stylesheet]')).filter(function (link) {\n        var val = link.getAttribute('data-autoreload');\n        return link.href && val != 'false';\n      }).forEach(function (link) {\n        link.href = cacheBuster(link.href);\n      });\n\n      // Hack to force page repaint after 25ms.\n      if (forceRepaint) setTimeout(function () {\n        document.body.offsetHeight;\n      }, 25);\n    },\n\n    javascript: function javascript() {\n      var scripts = [].slice.call(document.querySelectorAll('script'));\n      var textScripts = scripts.map(function (script) {\n        return script.text;\n      }).filter(function (text) {\n        return text.length > 0;\n      });\n      var srcScripts = scripts.filter(function (script) {\n        return script.src;\n      });\n\n      var loaded = 0;\n      var all = srcScripts.length;\n      var onLoad = function onLoad() {\n        loaded = loaded + 1;\n        if (loaded === all) {\n          textScripts.forEach(function (script) {\n            eval(script);\n          });\n        }\n      };\n\n      srcScripts.forEach(function (script) {\n        var src = script.src;\n        script.remove();\n        var newScript = document.createElement('script');\n        newScript.src = cacheBuster(src);\n        newScript.async = true;\n        newScript.onload = onLoad;\n        document.head.appendChild(newScript);\n      });\n    }\n  };\n  var port = ar.port || 9485;\n  var host = br.server || window.location.hostname || 'localhost';\n\n  var connect = function connect() {\n    var connection = new WebSocket('ws://' + host + ':' + port);\n    connection.onmessage = function (event) {\n      if (ar.disabled) return;\n      var message = event.data;\n      var reloader = reloaders[message] || reloaders.page;\n      reloader();\n    };\n    connection.onerror = function () {\n      if (connection.readyState) connection.close();\n    };\n    connection.onclose = function () {\n      window.setTimeout(connect, 1000);\n    };\n  };\n  connect();\n})();\n/* jshint ignore:end */\n"]}