{"version":3,"sources":["app/app.js","node_modules/auto-reload-brunch/vendor/auto-reload.js"],"names":["$","click","event","preventDefault","window","open","href","content_gpx","location","change","toggleClass","tooltip","placement","ParseFile","file","reader","FileReader","parser","doc","fileinfo","name","size","onload","e","DOMParser","parseFromString","target","result","ActiveXObject","async","loadXML","documentElement","tagName","html","removeClass","readAsText","addClass","attr","val","btn","button","ajax","url","type","data","gpx","locale","toc","note","short_desc","long_desc","hint","hint_encrypted","parseInt","waypoints","spoilers","logs","sort_by","pagebreak","images","pocket_guid","success","message","show","redirect","failure","document","getElementById","ready","tinymce","init","selector","language","plugins","content_css","menubar","toolbar1","toolbar2","browser_spellcheck","pagebreak_separator","width","height","schema","apply_source_formatting","setup","editor","on","prop","hasClass","confirm","ed","tinyMCE","get","setProgressState","id","roadbook_id","getJSON","each","key","is","substr","saveHtml","_ajax","modal","_ajax_exp","datatype","content","getContent","beforeSend","last_modification","startContent","isNotDirty","complete","real_export","forms","page_size","value","orientation","margin_left","margin_right","margin_top","margin_bottom","header_align","header_text","footer_align","footer_text","alert","link","error","experimental","fileinput","files","dataTransfer","WebSocket","MozWebSocket","br","brunch","ar","disabled","_ar","cacheBuster","date","Math","round","Date","now","toString","replace","indexOf","browser","navigator","userAgent","toLowerCase","forceRepaint","reloaders","page","reload","stylesheet","slice","call","querySelectorAll","filter","getAttribute","forEach","setTimeout","body","offsetHeight","javascript","scripts","textScripts","map","script","text","length","srcScripts","src","loaded","all","onLoad","eval","remove","newScript","createElement","head","appendChild","port","host","server","hostname","connect","connection","onmessage","reloader","onerror","readyState","close","onclose"],"mappings":"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","file":"web/app.min.js","sourcesContent":["/* jshint esversion: 6 */\n/* global $:true */\n\n(function() {\n    \"use strict\";\n\n    $(\"#spoilers4gpx\").click(function(event) {\n        event.preventDefault();\n        window.open(this.href);\n    });\n\n    var content_gpx = null;\n\n    $(\"#btn_geocaching\").click(function() {\n        window.location = \"/login\";\n    });\n\n    $(\"#hint\").change(function() {\n        $(\"#hint_options\").toggleClass(\"hidden\");\n    });\n\n    $(\"#sort\").change(function() {\n        $(\"#sort_options\").toggleClass(\"hidden\");\n    });\n\n    $(\".option-help\").tooltip({\n        placement: \"right\"\n    });\n\n    // output file information\n    function ParseFile(file) {\n        var reader = new FileReader(),\n            parser, doc, fileinfo = [{\n                \"name\": file.name,\n                \"size\": file.size\n            }];\n\n        reader.onload = function(e) {\n            if (window.DOMParser) {\n                parser = new DOMParser();\n                doc = parser.parseFromString(e.target.result, \"application/xml\");\n            } else {\n                doc = new ActiveXObject(\"Microsoft.XMLDOM\");\n                doc.async = \"false\";\n                doc.loadXML(e.target.result);\n            }\n\n            if (!doc || doc.documentElement.tagName !== \"gpx\") {\n                content_gpx = null;\n                $(\"#error\").html(\"<p>\\\"\" + fileinfo[0].name + \"\\\" in an invalid file.<p>\").removeClass(\"hidden\");\n                return false;\n            }\n            content_gpx = e.target.result;\n        };\n\n        /*jshint -W030 */\n        reader.readAsText(file, \"UTF-8\");\n    }\n\n    $(\"#create\").click(function() {\n        $(\"#error\").addClass(\"hidden\").html(\"\");\n\n        if ((!content_gpx && $(\"#pocket_list\").attr(\"selected\", \"selected\").val() === \"undefined\") || (!content_gpx && $(\"#pocket_list\").attr(\"selected\", \"selected\").val() === \"\")) {\n            $(\"#error\").html(\"<p>A GPX file or a Pocket Query is missing.</p>\").removeClass(\"hidden\");\n            return false;\n        }\n\n        var btn = $(this);\n        btn.button(\"loading\");\n\n        $.ajax({\n            url: \"/upload\",\n            type: \"POST\",\n            data: {\n                gpx: content_gpx,\n                locale: $(\"#locale\").attr(\"selected\", \"selected\").val(),\n                toc: !!$(\"input[name=\\\"toc\\\"]:checked\").val(),\n                note: !!$(\"input[name=\\\"note\\\"]:checked\").val(),\n                short_desc: !!$(\"input[name=\\\"short_desc\\\"]:checked\").val(),\n                long_desc: !!$(\"input[name=\\\"long_desc\\\"]:checked\").val(),\n                hint: !!$(\"input[name=\\\"hint\\\"]:checked\").val(),\n                hint_encrypted: !!parseInt($(\"input[name=\\\"hint_encrypted\\\"]:checked\").val()),\n                waypoints: !!$(\"input[name=\\\"waypoints\\\"]:checked\").val(),\n                spoilers: !!$(\"input[name=\\\"spoilers\\\"]:checked\").val(),\n                logs: !!$(\"input[name=\\\"logs\\\"]:checked\").val(),\n                sort_by: $(\"input[name=\\\"sort_by\\\"]:checked\").val(),\n                pagebreak: !!$(\"input[name=\\\"pagebreak\\\"]:checked\").val(),\n                images: !!$(\"input[name=\\\"images\\\"]:checked\").val(),\n                pocket_guid: $(\"#pocket_list\").attr(\"selected\", \"selected\").val()\n            },\n            success: function(data) {\n                if (!data || data === \"\" || typeof data !== \"object\") {\n                    return false;\n                }\n                if (data && !data.success) {\n                    $(\"#error\").html(\"<p>\" + data.message + \"</p>\").removeClass(\"hidden\").show();\n                    btn.button(\"reset\");\n                    return false;\n                }\n                $(location).attr(\"href\", data.redirect);\n            },\n            failure: function() {}\n        });\n        return false;\n    });\n\n    $(\"a[data-dismiss=\\\"fileupload\\\"]\").click(function() {\n        content_gpx = null;\n    });\n\n    /**** Roadbook *****/\n    if (document.getElementById(\"editable\") !== null) {\n        $().ready(function() {\n            // Config TinyMCE 4\n            tinymce.init({\n                selector: \"#editable\",\n                language: language,\n                plugins: [\n                    \"advlist autolink link image lists charmap hr anchor pagebreak\",\n                    \"searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking\",\n                    \"table contextmenu paste textcolor\"\n                ],\n                content_css: \"../design/roadbook.css\",\n                menubar: false,\n                toolbar1: \"undo redo | formatselect fontselect fontsizeselect | forecolor backcolor | bold italic underline strikethrough\",\n                toolbar2: \"alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image hr table subscript superscript charmap pagebreak | code fullscreen\",\n                browser_spellcheck: true,\n                pagebreak_separator: \"<p class=\\\"pagebreak\\\"><!-- pagebreak --></p>\",\n                width: \"210mm\",\n                height: \"297mm\",\n                schema: \"html4\",\n                apply_source_formatting: true,\n                setup: function(editor) {\n                    editor.on(\"change\", function() {\n                        $(\"#btn_save\").removeClass(\"disabled\").prop(\"disabled\", false);\n                    });\n                }\n            });\n        });\n    }\n\n    $(\"#btn_delete\").button().click(function() {\n        if ($(this).hasClass(\"disabled\")) {\n            return false;\n        }\n        if (!confirm(\"Are you sure to delete your roadbook?\")) {\n            return false;\n        }\n        var ed = tinyMCE.get(\"editable\");\n        ed.setProgressState(1);\n\n        $.ajax({\n            url: \"/delete\",\n            type: \"POST\",\n            data: {\n                id: roadbook_id\n            },\n            success: function(url) {\n                location.href = url;\n            },\n            failure: function() {\n                ed.setProgressState(0);\n            }\n        });\n    });\n\n    $(\"#ui_export,#ui_export_exp\").on(\"show\", function() {\n        if ($(\"#btn_export_title\").hasClass(\"disabled\")) {\n            return false;\n        }\n        $.getJSON(\"/roadbook/\" + roadbook_id + \".json\", function(data) {\n            $.each(data, function(key, val) {\n                //checkbox\n                if ($(\"#\" + key).is(\"input[type=checkbox]\")) {\n                    $(\"#\" + key).attr(\"value\", val);\n                    if (val) {\n                        $(\"#\" + key).prop(\"checked\", true);\n                        $(\"#\" + key.substr(0, 6) + \"_text\").prop(\"disabled\", true);\n                    }\n                } else if ($(\"#\" + key).is(\"select\")) {\n                    $(\"#\" + key).val(val);\n                    $(\"#\" + key + \" option[value=\" + val + \"]\").attr(\"selected\", \"selected\");\n                } else if ($(\"#\" + key).is(\"input\")) {\n                    $(\"#\" + key).attr(\"value\", val);\n                }\n            });\n        });\n    });\n\n    $(\"#btn_save\").click(function() {\n        if ($(this).hasClass(\"disabled\")) {\n            return false;\n        }\n        saveHtml();\n    });\n\n    $(\"#apply\").click(function() {\n        _ajax(false);\n    });\n\n    $(\"#export\").click(function() {\n        saveHtml();\n        $(\"#ui_export\").modal(\"hide\");\n        _ajax(true);\n    });\n\n    $(\"#apply_exp\").click(function() {\n        _ajax_exp(false);\n    });\n    $(\"#export_exp\").click(function() {\n        saveHtml();\n        $(\"#ui_export_exp\").modal(\"hide\");\n        _ajax_exp(true);\n    });\n\n    $(\"#header_pagination\").click(function() {\n        $(\"#header_text\").prop(\"disabled\", !$(\"#header_text\").prop(\"disabled\"));\n    });\n\n    $(\"#footer_pagination\").click(function() {\n        $(\"#footer_text\").prop(\"disabled\", !$(\"#footer_text\").prop(\"disabled\"));\n    });\n\n    var saveHtml = function() {\n        var ed = tinyMCE.get(\"editable\");\n        ed.setProgressState(1);\n        $.ajax({\n            url: \"/save\",\n            type: \"POST\",\n            datatype: \"json\",\n            data: {\n                id: roadbook_id,\n                content: ed.getContent()\n            },\n            beforeSend: function() {\n                $(\"#btn_save\").button(\"loading\");\n            },\n            success: function(data) {\n                if (data && data.success) {\n                    $(\"#btn_save\").attr(\"title\", data.last_modification);\n                    ed.startContent = ed.getContent();\n                    ed.isNotDirty = true;\n                }\n            },\n            complete: function() {\n                $(\"#btn_save\").addClass(\"disabled\").prop(\"disabled\", true).data(\"loading-text\", \"Save\").button(\"loading\");\n            },\n            failure: function() {}\n        });\n        ed.setProgressState(0);\n    };\n\n    var _ajax = function(real_export) {\n        var ed = tinyMCE.get(\"editable\");\n        ed.setProgressState(1);\n        real_export = +real_export;\n\n        $(\"#btn_save\").addClass(\"disabled\");\n        $(\"#btn_export_title\").addClass(\"disabled\");\n        $(\"#btn_export\").addClass(\"disabled\");\n        $(\"#btn_download_title\").addClass(\"disabled\");\n        $(\"#btn_download\").addClass(\"disabled\");\n        $(\"#btn_delete\").addClass(\"disabled\");\n\n        $.ajax({\n            url: \"/export\",\n            type: \"POST\",\n            data: {\n                real_export: real_export,\n                id: roadbook_id,\n                \"page-size\": document.forms[0].page_size.value,\n                \"orientation\": document.forms[0].orientation.value,\n                \"margin-left\": document.forms[0].margin_left.value,\n                \"margin-right\": document.forms[0].margin_right.value,\n                \"margin-top\": document.forms[0].margin_top.value,\n                \"margin-bottom\": document.forms[0].margin_bottom.value,\n                \"header-align\": document.forms[0].header_align.value,\n                \"header-text\": document.forms[0].header_text.value,\n                \"header-pagination\": !!$(\"input[name=\\\"header_pagination\\\"]:checked\").val(),\n                \"footer-align\": document.forms[0].footer_align.value,\n                \"footer-text\": document.forms[0].footer_text.value,\n                \"footer-pagination\": !!$(\"input[name=\\\"footer_pagination\\\"]:checked\").val(),\n            },\n\n            success: function(data) {\n                ed.setProgressState(0);\n\n                $(\"#btn_save\").removeClass(\"disabled\");\n                $(\"#btn_export_title\").removeClass(\"disabled\");\n                $(\"#btn_export\").removeClass(\"disabled\");\n                $(\"#btn_download_title\").removeClass(\"disabled\");\n                $(\"#btn_download\").removeClass(\"disabled\");\n                $(\"#btn_delete\").removeClass(\"disabled\");\n\n                if (!real_export) {\n                    return;\n                }\n\n                if (!data || data === \"\") {\n                    alert(\"Conversion failed :-(\");\n                    return;\n                }\n                if (typeof data !== \"object\") {\n                    alert(\"Conversion failed :-(\\nMessage:\\n\" + data);\n                    return;\n                }\n\n                if (data && data.success) {\n                    ed.setProgressState(0);\n                    $(\"#dl_pdf\").show();\n                    $(\"#download_link\").html(data.link + \" (\" + data.size + \"Mb)\");\n                    $(\"#ui_exported\").modal(\"show\");\n                } else {\n                    alert(\"Conversion failed :-(\\nMessage:\\n\" + data.error);\n                }\n            },\n            failure: function() {\n                ed.setProgressState(0);\n\n                $(\"#btn_save\").removeClass(\"disabled\");\n                $(\"#btn_export_title\").removeClass(\"disabled\");\n                $(\"#btn_export\").removeClass(\"disabled\");\n                $(\"#btn_download_title\").removeClass(\"disabled\");\n                $(\"#btn_download\").removeClass(\"disabled\");\n                $(\"#btn_delete\").removeClass(\"disabled\");\n\n                if (!real_export) {\n                    return;\n                }\n                alert(\"Error in exportation.\");\n            }\n        });\n    };\n\n    var _ajax_exp = function(real_export) {\n        var ed = tinyMCE.get(\"editable\");\n        ed.setProgressState(1);\n        real_export = +real_export;\n\n        $(\"#btn_save\").addClass(\"disabled\");\n        $(\"#btn_export_title\").addClass(\"disabled\");\n        $(\"#btn_export\").addClass(\"disabled\");\n        $(\"#btn_download_title\").addClass(\"disabled\");\n        $(\"#btn_download\").addClass(\"disabled\");\n        $(\"#btn_delete\").addClass(\"disabled\");\n\n        $.ajax({\n            url: \"/export\",\n            type: \"POST\",\n            data: {\n                real_export: real_export,\n                id: roadbook_id,\n                experimental: true,\n                \"page-size\": document.forms[1].page_size.value,\n                \"orientation\": document.forms[1].orientation.value,\n                \"margin-left\": document.forms[1].margin_left.value,\n                \"margin-right\": document.forms[1].margin_right.value,\n                \"margin-top\": document.forms[1].margin_top.value,\n                \"margin-bottom\": document.forms[1].margin_bottom.value,\n            },\n\n            success: function(data) {\n                ed.setProgressState(0);\n\n                $(\"#btn_save\").removeClass(\"disabled\");\n                $(\"#btn_export_title\").removeClass(\"disabled\");\n                $(\"#btn_export\").removeClass(\"disabled\");\n                $(\"#btn_download_title\").removeClass(\"disabled\");\n                $(\"#btn_download\").removeClass(\"disabled\");\n                $(\"#btn_delete\").removeClass(\"disabled\");\n\n                if (!real_export) {\n                    return;\n                }\n\n                if (!data || data === \"\") {\n                    alert(\"Conversion failed :-(\");\n                    return;\n                }\n                if (typeof data !== \"object\") {\n                    alert(\"Conversion failed :-(\\nMessage:\\n\" + data);\n                    return;\n                }\n\n                if (data && data.success) {\n                    ed.setProgressState(0);\n                    $(\"#dl_pdf\").show();\n                    $(\"#download_link\").html(data.link + \" (\" + data.size + \"Mb)\");\n                    $(\"#ui_exported\").modal(\"show\");\n                } else {\n                    alert(\"Conversion failed :-(\\nMessage:\\n\" + data.error);\n                }\n            },\n            failure: function() {\n                ed.setProgressState(0);\n\n                $(\"#btn_save\").removeClass(\"disabled\");\n                $(\"#btn_export_title\").removeClass(\"disabled\");\n                $(\"#btn_export\").removeClass(\"disabled\");\n                $(\"#btn_download_title\").removeClass(\"disabled\");\n                $(\"#btn_download\").removeClass(\"disabled\");\n                $(\"#btn_delete\").removeClass(\"disabled\");\n\n                if (!real_export) {\n                    return;\n                }\n                alert(\"Error in exportation.\");\n            }\n        });\n    };\n\n    // init\n    if (typeof $(\"#gpx\").fileinput === \"function\") {\n        $(\"#gpx\")\n            .fileinput({\n                \"browseLabel\": \"GPX file\",\n                \"showPreview\": true,\n                \"showUpload\": false,\n                \"maxFileCount\": 1,\n                \"autoReplace\": true,\n                \"maxFileSize\": 8192,\n                \"allowedFileExtensions\": [\"gpx\"]\n            })\n            .on(\"change\", function(e) {\n                // fetch FileList object\n                var files = e.target.files || e.dataTransfer.files;\n                if (typeof files[0] === \"undefined\") {\n                    return false;\n                }\n                ParseFile(files[0]);\n            });\n    }\n}());\n","/* jshint ignore:start */\n(function() {\n  var WebSocket = window.WebSocket || window.MozWebSocket;\n  var br = window.brunch = (window.brunch || {});\n  var ar = br['auto-reload'] = (br['auto-reload'] || {});\n  if (!WebSocket || ar.disabled) return;\n  if (window._ar) return;\n  window._ar = true;\n\n  var cacheBuster = function(url){\n    var date = Math.round(Date.now() / 1000).toString();\n    url = url.replace(/(\\&|\\\\?)cacheBuster=\\d*/, '');\n    return url + (url.indexOf('?') >= 0 ? '&' : '?') +'cacheBuster=' + date;\n  };\n\n  var browser = navigator.userAgent.toLowerCase();\n  var forceRepaint = ar.forceRepaint || browser.indexOf('chrome') > -1;\n\n  var reloaders = {\n    page: function(){\n      window.location.reload(true);\n    },\n\n    stylesheet: function(){\n      [].slice\n        .call(document.querySelectorAll('link[rel=stylesheet]'))\n        .filter(function(link) {\n          var val = link.getAttribute('data-autoreload');\n          return link.href && val != 'false';\n        })\n        .forEach(function(link) {\n          link.href = cacheBuster(link.href);\n        });\n\n      // Hack to force page repaint after 25ms.\n      if (forceRepaint) setTimeout(function() { document.body.offsetHeight; }, 25);\n    },\n\n    javascript: function(){\n      var scripts = [].slice.call(document.querySelectorAll('script'));\n      var textScripts = scripts.map(function(script) { return script.text }).filter(function(text) { return text.length > 0 });\n      var srcScripts = scripts.filter(function(script) { return script.src });\n\n      var loaded = 0;\n      var all = srcScripts.length;\n      var onLoad = function() {\n        loaded = loaded + 1;\n        if (loaded === all) {\n          textScripts.forEach(function(script) { eval(script); });\n        }\n      }\n\n      srcScripts\n        .forEach(function(script) {\n          var src = script.src;\n          script.remove();\n          var newScript = document.createElement('script');\n          newScript.src = cacheBuster(src);\n          newScript.async = true;\n          newScript.onload = onLoad;\n          document.head.appendChild(newScript);\n        });\n    }\n  };\n  var port = ar.port || 9485;\n  var host = br.server || window.location.hostname || 'localhost';\n\n  var connect = function(){\n    var connection = new WebSocket('ws://' + host + ':' + port);\n    connection.onmessage = function(event){\n      if (ar.disabled) return;\n      var message = event.data;\n      var reloader = reloaders[message] || reloaders.page;\n      reloader();\n    };\n    connection.onerror = function(){\n      if (connection.readyState) connection.close();\n    };\n    connection.onclose = function(){\n      window.setTimeout(connect, 1000);\n    };\n  };\n  connect();\n})();\n/* jshint ignore:end */\n"]}