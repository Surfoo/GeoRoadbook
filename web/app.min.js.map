{"version":3,"sources":["app/app.js"],"names":["require","register","exports","module","_typeof","Symbol","iterator","obj","constructor","prototype","ParseFile","file","parser","doc","reader","FileReader","fileinfo","name","size","onload","e","window","DOMParser","parseFromString","target","result","ActiveXObject","async","loadXML","documentElement","tagName","content_gpx","$","html","show","delay","fadeOut","readAsText","click","event","preventDefault","open","this","href","location","change","toggleClass","tooltip","placement","addClass","attr","val","btn","button","ajax","url","type","data","gpx","locale","toc","note","short_desc","long_desc","hint","hint_encrypted","parseInt","waypoints","spoilers","logs","sort_by","pagebreak","images","pocket_guid","success","message","redirect","failure","document","getElementById","ready","tinymce","init","selector","language","plugins","content_css","menubar","toolbar1","toolbar2","browser_spellcheck","pagebreak_separator","width","height","schema","apply_source_formatting","setup","editor","on","removeClass","prop","hasClass","confirm","ed","tinyMCE","get","setProgressState","id","roadbook_id","getJSON","each","key","is","substr","saveHtml","_ajax","modal","_ajax_exp","datatype","content","getContent","beforeSend","last_modification","startContent","isNotDirty","complete","real_export","page-size","forms","page_size","value","orientation","margin-left","margin_left","margin-right","margin_right","margin-top","margin_top","margin-bottom","margin_bottom","header-align","header_align","header-text","header_text","header-pagination","footer-align","footer_align","footer-text","footer_text","footer-pagination","alert","link","error","experimental","fileinput","browseLabel","showPreview","showUpload","maxFileCount","autoReplace","maxFileSize","allowedFileExtensions","files","dataTransfer"],"mappings":"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","file":"web/app.min.js.map","sourcesContent":["/* jshint esversion: 6 */\n/* global $:true */\n\n(function() {\n    'use strict';\n\n    $('#spoilers4gpx').click(function(event) {\n        event.preventDefault();\n        window.open(this.href);\n    });\n\n    var content_gpx = null;\n\n    $('#btn_geocaching').click(function() {\n        window.location = '/login';\n    });\n\n    $('#hint').change(function() {\n        $('#hint_options').toggleClass('hidden');\n    });\n\n    $('#sort').change(function() {\n        $('#sort_options').toggleClass('hidden');\n    });\n\n    $('.option-help').tooltip({\n        placement: 'right'\n    });\n\n    // output file information\n    function ParseFile(file) {\n        var reader = new FileReader(),\n            parser, doc, fileinfo = [{\n                'name': file.name,\n                'size': file.size\n            }];\n\n        reader.onload = function(e) {\n                if (window.DOMParser) {\n                    parser = new DOMParser();\n                    doc = parser.parseFromString(e.target.result, 'text/xml');\n                } else {\n                    doc = new ActiveXObject('Microsoft.XMLDOM');\n                    doc.async = 'false';\n                    doc.loadXML(e.target.result);\n                }\n\n                doc = parser.parseFromString(e.target.result, 'application/xml');\n                if (!doc || doc.documentElement.tagName != 'gpx') {\n                    content_gpx = null;\n                    $('#error').html('<p>\"' + fileinfo[0].name + '\" in an invalid file.<p>').show().delay(3000).fadeOut();\n                    return false;\n                }\n                content_gpx = e.target.result;\n            },\n            /*jshint -W030 */\n            reader.readAsText(file, 'UTF-8');\n    }\n\n    $('input[type=\"submit\"]').click(function() {\n        $('#error').html('').addClass('hidden');\n\n        if ((!content_gpx && $('#pocket_list').attr('selected', 'selected').val() === 'undefined') || (!content_gpx && $('#pocket_list').attr('selected', 'selected').val() === '')) {\n            $('#error').html('<p>A GPX file or a Pocket Query is missing.</p>').toggleClass('hidden');\n            return false;\n        }\n\n        var btn = $(this);\n        btn.button('loading');\n\n        $.ajax({\n            url: \"/upload\",\n            type: \"POST\",\n            data: {\n                gpx: content_gpx,\n                locale: $('#locale').attr('selected', 'selected').val(),\n                toc: !!$('input[name=\"toc\"]:checked').val(),\n                note: !!$('input[name=\"note\"]:checked').val(),\n                short_desc: !!$('input[name=\"short_desc\"]:checked').val(),\n                long_desc: !!$('input[name=\"long_desc\"]:checked').val(),\n                hint: !!$('input[name=\"hint\"]:checked').val(),\n                hint_encrypted: !!parseInt($('input[name=\"hint_encrypted\"]:checked').val()),\n                waypoints: !!$('input[name=\"waypoints\"]:checked').val(),\n                spoilers: !!$('input[name=\"spoilers\"]:checked').val(),\n                logs: !!$('input[name=\"logs\"]:checked').val(),\n                sort_by: $('input[name=\"sort_by\"]:checked').val(),\n                pagebreak: !!$('input[name=\"pagebreak\"]:checked').val(),\n                images: !!$('input[name=\"images\"]:checked').val(),\n                pocket_guid: $('#pocket_list').attr('selected', 'selected').val()\n            },\n            success: function(data) {\n                if (!data || data === \"\" || typeof data !== 'object') {\n                    return;\n                }\n                if (data && !data.success) {\n                    $('#error').html('<p>' + data.message + '</p>').show();\n                    btn.button('reset');\n                    return;\n                }\n                $(location).attr('href', data.redirect);\n            },\n            failure: function() {}\n        });\n        return false;\n    });\n\n    $('a[data-dismiss=\"fileupload\"]').click(function() {\n        content_gpx = null;\n    });\n\n    /**** Roadbook *****/\n    if (document.getElementById('editable') !== null) {\n        $().ready(function() {\n            // Config TinyMCE 4\n            tinymce.init({\n                selector: \"#editable\",\n                language: language,\n                plugins: [\n                    \"advlist autolink link image lists charmap hr anchor pagebreak\",\n                    \"searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking\",\n                    \"table contextmenu paste textcolor\"\n                ],\n                content_css: \"../design/roadbook.css\",\n                menubar: false,\n                toolbar1: \"undo redo | formatselect fontselect fontsizeselect | forecolor backcolor | bold italic underline strikethrough\",\n                toolbar2: \"alignleft aligncenter alignright alignjustify |Â bullist numlist outdent indent | link image hr table subscript superscript charmap pagebreak | code fullscreen\",\n                browser_spellcheck: true,\n                pagebreak_separator: \"<p class=\\\"pagebreak\\\"><!-- pagebreak --></p>\",\n                width: \"210mm\",\n                height: \"297mm\",\n                schema: \"html4\",\n                apply_source_formatting: true,\n                setup: function(editor) {\n                    editor.on('change', function() {\n                        $('#btn_save').removeClass('disabled').prop('disabled', false);\n                    });\n                }\n            });\n        });\n    }\n\n    $(\"#btn_delete\").button().click(function() {\n        if ($(this).hasClass('disabled')) {\n            return false;\n        }\n        if (!confirm('Are you sure to delete your roadbook?')) {\n            return false;\n        }\n        var ed = tinyMCE.get('editable');\n        ed.setProgressState(1);\n\n        $.ajax({\n            url: \"/delete\",\n            type: \"POST\",\n            data: {\n                id: roadbook_id\n            },\n            success: function(url) {\n                location.href = url;\n            },\n            failure: function() {\n                ed.setProgressState(0);\n            }\n        });\n    });\n\n    $('#ui_export').on('show', function() {\n        if ($('#btn_export_title').hasClass('disabled')) {\n            return false;\n        }\n        $.getJSON('/roadbook/' + roadbook_id + '.json', function(data) {\n            $.each(data, function(key, val) {\n                //checkbox\n                if ($('#' + key).is('input[type=checkbox]')) {\n                    $('#' + key).attr(\"value\", val);\n                    if (val) {\n                        $('#' + key).prop('checked', true);\n                        $(\"#\" + key.substr(0, 6) + \"_text\").prop('disabled', true);\n                    }\n                } else if ($('#' + key).is('select')) {\n                    $('#' + key).val(val);\n                    $('#' + key + ' option[value=' + val + ']').attr('selected', 'selected');\n                } else if ($('#' + key).is('input')) {\n                    $('#' + key).attr(\"value\", val);\n                }\n            });\n        });\n    });\n\n    $('#ui_export_exp').on('show', function() {\n        if ($('#btn_export_title').hasClass('disabled')) {\n            return false;\n        }\n        $.getJSON('/roadbook/' + roadbook_id + '.json', function(data) {\n            $.each(data, function(key, val) {\n                //checkbox\n                if ($('#' + key).is('input[type=checkbox]')) {\n                    $('#' + key).attr(\"value\", val);\n                    if (val) {\n                        $('#' + key).prop('checked', true);\n                        $(\"#\" + key.substr(0, 6) + \"_text\").prop('disabled', true);\n                    }\n                } else if ($('#' + key).is('select')) {\n                    $('#' + key).val(val);\n                    $('#' + key + ' option[value=' + val + ']').attr('selected', 'selected');\n                } else if ($('#' + key).is('input')) {\n                    $('#' + key).attr(\"value\", val);\n                }\n            });\n        });\n    });\n\n    $(\"#btn_save\").click(function() {\n        if ($(this).hasClass('disabled')) {\n            return false;\n        }\n        saveHtml();\n    });\n\n    $(\"#apply\").click(function() {\n        _ajax(false);\n    });\n\n    $(\"#export\").click(function() {\n        saveHtml();\n        $('#ui_export').modal('hide');\n        _ajax(true);\n    });\n\n    $(\"#apply_exp\").click(function() {\n        _ajax_exp(false);\n    });\n    $(\"#export_exp\").click(function() {\n        saveHtml();\n        $('#ui_export_exp').modal('hide');\n        _ajax_exp(true);\n    });\n\n    $(\"#header_pagination\").click(function() {\n        $(\"#header_text\").prop('disabled', !$(\"#header_text\").prop(\"disabled\"));\n    });\n\n    $(\"#footer_pagination\").click(function() {\n        $(\"#footer_text\").prop('disabled', !$(\"#footer_text\").prop(\"disabled\"));\n    });\n\n    var saveHtml = function() {\n        var ed = tinyMCE.get('editable');\n        ed.setProgressState(1);\n        $.ajax({\n            url: \"/save\",\n            type: \"POST\",\n            datatype: 'json',\n            data: {\n                id: roadbook_id,\n                content: ed.getContent()\n            },\n            beforeSend: function() {\n                $('#btn_save').button('loading');\n            },\n            success: function(data) {\n                if (data && data.success) {\n                    $('#btn_save').attr('title', data.last_modification);\n                    ed.startContent = ed.getContent();\n                    ed.isNotDirty = true;\n                }\n            },\n            complete: function() {\n                $('#btn_save').addClass('disabled').prop('disabled', true).data('loading-text', 'Save').button('loading');\n            },\n            failure: function() {}\n        });\n        ed.setProgressState(0);\n    };\n\n    var _ajax = function(real_export) {\n        var ed = tinyMCE.get('editable');\n        ed.setProgressState(1);\n        real_export = +real_export;\n\n        $('#btn_save').addClass('disabled');\n        $('#btn_export_title').addClass('disabled');\n        $('#btn_export').addClass('disabled');\n        $('#btn_download_title').addClass('disabled');\n        $('#btn_download').addClass('disabled');\n        $('#btn_delete').addClass('disabled');\n\n        $.ajax({\n            url: \"/export\",\n            type: \"POST\",\n            data: {\n                real_export: real_export,\n                id: roadbook_id,\n                'page-size': document.forms[0].page_size.value,\n                'orientation': document.forms[0].orientation.value,\n                'margin-left': document.forms[0].margin_left.value,\n                'margin-right': document.forms[0].margin_right.value,\n                'margin-top': document.forms[0].margin_top.value,\n                'margin-bottom': document.forms[0].margin_bottom.value,\n                'header-align': document.forms[0].header_align.value,\n                'header-text': document.forms[0].header_text.value,\n                'header-pagination': !!$('input[name=\"header_pagination\"]:checked').val(),\n                'footer-align': document.forms[0].footer_align.value,\n                'footer-text': document.forms[0].footer_text.value,\n                'footer-pagination': !!$('input[name=\"footer_pagination\"]:checked').val(),\n            },\n\n            success: function(data) {\n                ed.setProgressState(0);\n\n                $('#btn_save').removeClass('disabled');\n                $('#btn_export_title').removeClass('disabled');\n                $('#btn_export').removeClass('disabled');\n                $('#btn_download_title').removeClass('disabled');\n                $('#btn_download').removeClass('disabled');\n                $('#btn_delete').removeClass('disabled');\n\n                if (!real_export) {\n                    return;\n                }\n\n                if (!data || data === \"\") {\n                    alert('Conversion failed :-(');\n                    return;\n                }\n                if (typeof data !== 'object') {\n                    alert('Conversion failed :-(\\nMessage:\\n' + data);\n                    return;\n                }\n\n                if (data && data.success) {\n                    ed.setProgressState(0);\n                    $('#dl_pdf').show();\n                    $('#download_link').html(data.link + ' (' + data.size + 'Mb)');\n                    $('#ui_exported').modal('show');\n                } else {\n                    alert('Conversion failed :-(\\nMessage:\\n' + data.error);\n                }\n            },\n            failure: function() {\n                ed.setProgressState(0);\n\n                $('#btn_save').removeClass('disabled');\n                $('#btn_export_title').removeClass('disabled');\n                $('#btn_export').removeClass('disabled');\n                $('#btn_download_title').removeClass('disabled');\n                $('#btn_download').removeClass('disabled');\n                $('#btn_delete').removeClass('disabled');\n\n                if (!real_export) {\n                    return;\n                }\n                alert('Error in exportation.');\n            }\n        });\n    };\n\n    var _ajax_exp = function(real_export) {\n        var ed = tinyMCE.get('editable');\n        ed.setProgressState(1);\n        real_export = +real_export;\n\n        $('#btn_save').addClass('disabled');\n        $('#btn_export_title').addClass('disabled');\n        $('#btn_export').addClass('disabled');\n        $('#btn_download_title').addClass('disabled');\n        $('#btn_download').addClass('disabled');\n        $('#btn_delete').addClass('disabled');\n\n        $.ajax({\n            url: \"/export\",\n            type: \"POST\",\n            data: {\n                real_export: real_export,\n                id: roadbook_id,\n                experimental: true,\n                'page-size': document.forms[1].page_size.value,\n                'orientation': document.forms[1].orientation.value,\n                'margin-left': document.forms[1].margin_left.value,\n                'margin-right': document.forms[1].margin_right.value,\n                'margin-top': document.forms[1].margin_top.value,\n                'margin-bottom': document.forms[1].margin_bottom.value,\n            },\n\n            success: function(data) {\n                ed.setProgressState(0);\n\n                $('#btn_save').removeClass('disabled');\n                $('#btn_export_title').removeClass('disabled');\n                $('#btn_export').removeClass('disabled');\n                $('#btn_download_title').removeClass('disabled');\n                $('#btn_download').removeClass('disabled');\n                $('#btn_delete').removeClass('disabled');\n\n                if (!real_export) {\n                    return;\n                }\n\n                if (!data || data === \"\") {\n                    alert('Conversion failed :-(');\n                    return;\n                }\n                if (typeof data !== 'object') {\n                    alert('Conversion failed :-(\\nMessage:\\n' + data);\n                    return;\n                }\n\n                if (data && data.success) {\n                    ed.setProgressState(0);\n                    $('#dl_pdf').show();\n                    $('#download_link').html(data.link + ' (' + data.size + 'Mb)');\n                    $('#ui_exported').modal('show');\n                } else {\n                    alert('Conversion failed :-(\\nMessage:\\n' + data.error);\n                }\n            },\n            failure: function() {\n                ed.setProgressState(0);\n\n                $('#btn_save').removeClass('disabled');\n                $('#btn_export_title').removeClass('disabled');\n                $('#btn_export').removeClass('disabled');\n                $('#btn_download_title').removeClass('disabled');\n                $('#btn_download').removeClass('disabled');\n                $('#btn_delete').removeClass('disabled');\n\n                if (!real_export) {\n                    return;\n                }\n                alert('Error in exportation.');\n            }\n        });\n    };\n\n    // init\n    if (typeof $(\"#gpx\").fileinput === 'function') {\n        $(\"#gpx\")\n            .fileinput({\n                'browseLabel': 'GPX file',\n                'showPreview': true,\n                'showUpload': false,\n                'maxFileCount': 1,\n                'autoReplace': true,\n                'maxFileSize': 8192,\n                'allowedFileExtensions': ['gpx']\n            })\n            .on('change', function(e) {\n                // fetch FileList object\n                var files = e.target.files || e.dataTransfer.files;\n                if (typeof files[0] === 'undefined') {\n                    return false;\n                }\n                ParseFile(files[0]);\n            });\n    }\n}());"]}